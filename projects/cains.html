<!DOCTYPE html>
<html>
<head>
  <title>Cain's Jawbone Checker</title>
  <script>
    window.addEventListener("load", (event) => {
      const pagesTables = [1,2,3,4,5].map(
        (i) => document.getElementById(`pages${i}`)
      );
      for (let i = 1; i <= 100; i++) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
<td>${i}</td>
<td><input id="page${i}" type="number" min="1" max="100" /></td>
`;
        pagesTables[Math.floor((i - 1) / 20)].appendChild(tr);
      }
      const murdersTable = document.getElementById("murders");
      for (let i = 1; i <= 6; i++) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
<td>${i}.</td>
<td><input id="murdered${i}" type="text" /></td>
<td><input id="murderer${i}" type="text" /></td>
`;
        murdersTable.appendChild(tr);
      }
    });
    
    function fillPages() {
      const arr = document.getElementById("quickpages").value.split(/\D/g);
      
      if (arr.length !== 100) {
        alert(`Invalid length, expected 100 pages but found ${arr.length}`);
        return;
      }
      
      for (let i = 1; i <= 100; i++) {
        document.getElementById(`page${i}`).value = arr[i - 1];
      }
    }
    
    async function check() {
      // Why am I salting this hash?
      let pageStr = "salt,";
      for (let i = 1; i <= 100; i++) {
        pageStr += document.getElementById(`page${i}`).value + ","
      }
      pageStr += "salt";
      const pageHash = await sha256(pageStr);
      const pagesCorrect =
        pageHash === "5e6b6ace440034912bcea1a539065138ba63a70a027deb6cc38d2d8dd7e69130"
        || pageHash === "ba43453a59a1c7dc93c9ba3af402b48b8f28e306c85ae3291d11f797d44fbc3f";
      
      let murdersStr = "salt,";
      for (let i = 1; i <= 6; i++) {
        murdersStr += document.getElementById(`murdered${i}`).value.replaceAll(/[^A-Za-z]/g, "").toLowerCase() + ","
        murdersStr += document.getElementById(`murderer${i}`).value.replaceAll(/[^A-Za-z]/g, "").toLowerCase() + ","
      }
      murdersStr += "salt";
      const murdersCorrect = await sha256(murdersStr) === "ed13cf36e1a8e29daec8cf6871148a6f67f94ed06a7fd166e452757510e02b28";
      
      if (pagesCorrect && murdersCorrect) {
        alert("Correct");
      } else if (pagesCorrect) {
        alert("Incorrect (murders)");
      } else if (murdersCorrect) {
        alert("Incorrect (pages)");
      } else {
        alert("Incorrect (both)");
      }
    }
    
    async function sha256(message) {
      const data = new TextEncoder().encode(message)
      const buffer = await window.crypto.subtle.digest("SHA-256", data);
      const hex = Array.from(new Uint8Array(buffer))
        .map((b) => b.toString(16).padStart(2, "0"))
        .join("");
      return hex;
    }
  </script>
  <style>
    table {
      border: 1px solid black;
      border-collapse: collapse;
    }
    
    td {
      border-top: 1px solid black;
      border-collapse: collapse;
      text-align: center;
    }
    
    th {
      border-left: 1px solid black;
    }
    
    #pages {
      display: flex;
      gap: 2em;
    }
    
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
      text-align: center;
    }
    input[type=number] {
      -moz-appearance: textfield;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Cain's Jawbone Solution Checker</h1>

  <h2>Pages</h2>
  <p>
    Quick page entry:<br>
    Paste a sequence of pages of the form "2,3,1" or "2 3 1" etc.<br>
    <input id="quickpages" type="text" autocomplete="off"/> <button onclick="fillPages()">Fill</button>
  </p>
  <div id="pages">
    <table id="pages1">
      <tr>
        <th>Printed<br>page</th>
        <th>Should<br>be</th>
      </tr>
    </table>
    <table id="pages2">
      <tr>
        <th>Printed<br>page</th>
        <th>Should<br>be</th>
      </tr>
    </table>
    <table id="pages3">
      <tr>
        <th>Printed<br>page</th>
        <th>Should<br>be</th>
      </tr>
    </table>
    <table id="pages4">
      <tr>
        <th>Printed<br>page</th>
        <th>Should<br>be</th>
      </tr>
    </table>
    <table id="pages5">
      <tr>
        <th>Printed<br>page</th>
        <th>Should<br>be</th>
      </tr>
    </table>
  </div>
  
  <h2>Murders</h2>
  <p>
    Enter murders in the order by which they occur.<br>
    Use the most common name in English and include both first and last name if available. Do not use honorifics or titles.<br>
    Use only unaccented English letters. Capitalization does not matter.<br>
    E.g. for Sir Alexander Chapman Ferguson, write "Alex Ferguson". For Pel&eacute; (Edson Arantes do Nascimento), write "Pele".
  </p>
  <table id="murders">
    <tr>
      <th>#</th>
      <th>Murdered person</th>
      <th>Murdered by</th>
    </tr>
  </table>
  
  <h2>Check</h2>
  <button onclick="check()">Check</button>
</body>
